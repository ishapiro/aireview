import{_ as I}from"./C9o6SUgA.js";import{B as q,C as j,D as N,s as f,E as C,x as z,y as L,c as k,a as s,b as l,w as n,l as d,o as g,A as h,d as E,m as G,z as H}from"./Bf3otjuS.js";import{u as K}from"./ByTvV72R.js";const Q={class:"max-w-4xl mx-auto"},R={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},W={class:"md:col-span-2"},X={class:"space-y-6"},Y={class:"field"},Z={class:"field"},$={class:"field"},ee={class:"space-y-6"},se=["value"],ae={class:"field"},le={class:"field"},oe={class:"field"},te={class:"space-y-6"},re={class:"space-y-4"},ie={class:"flex items-center justify-between"},ne={key:0},de={key:1},ue={class:"space-y-4"},me={class:"space-y-4"},we={__name:"profile",setup(ce){const v=K(),u=q(),i=j();N();const m=f({}),p=f(""),b=f(!1),_=f(!1),t=f({fullName:"",email:"",bio:"",avatar_url:""}),r=f({currentPassword:"",newPassword:"",confirmPassword:""});u.value||C("/auth/login");const x=async()=>{var a;try{const{data:e,error:w}=await v.from("profiles").select("*").eq("id",(a=u.value)==null?void 0:a.id).single();if(w)throw w;m.value=e,t.value={fullName:e.full_name,email:e.email,bio:e.bio||"",avatar_url:e.avatar_url},console.log("Fetched profile:",JSON.parse(JSON.stringify(e))),console.log("Assigned to form.value:",JSON.parse(JSON.stringify(t.value)))}catch(e){console.error("Error fetching profile:",e),i.add({severity:"error",summary:"Error",detail:"Failed to load profile",life:3e3})}};z(()=>{u.value&&x()}),L(u,a=>{a?x():(m.value={},t.value={fullName:"",email:"",bio:"",avatar_url:""})});const T=async()=>{b.value=!0,p.value="";try{const{error:a}=await v.from("profiles").update({full_name:t.value.fullName,bio:t.value.bio,avatar_url:t.value.avatar_url}).eq("id",u.value.id);if(a)throw a;i.add({severity:"success",summary:"Success",detail:"Profile updated successfully!",life:3e3}),await x(),console.log("Profile updated and refetched")}catch(a){p.value=a.message,i.add({severity:"error",summary:"Error",detail:a.message,life:3e3})}finally{b.value=!1}},U=async()=>{if(r.value.newPassword!==r.value.confirmPassword){i.add({severity:"error",summary:"Error",detail:"New passwords do not match",life:3e3});return}_.value=!0,p.value="";try{const{error:a}=await v.auth.updateUser({password:r.value.newPassword});if(a)throw a;i.add({severity:"success",summary:"Success",detail:"Password changed successfully!",life:3e3}),r.value={currentPassword:"",newPassword:"",confirmPassword:""}}catch(a){p.value=a.message,i.add({severity:"error",summary:"Error",detail:a.message,life:3e3})}finally{_.value=!1}},B=()=>{i.add({severity:"info",summary:"Coming Soon",detail:"Subscription upgrade functionality to be implemented",life:3e3})},A=()=>{i.add({severity:"info",summary:"Coming Soon",detail:"Subscription management functionality to be implemented",life:3e3})},M=async()=>{if(await new Promise(e=>{N()}))try{const{error:e}=await v.auth.admin.deleteUser(u.value.id);if(e)throw e;await v.auth.signOut(),C("/")}catch(e){p.value=e.message,i.add({severity:"error",summary:"Error",detail:e.message,life:3e3})}};return(a,e)=>{const w=d("InputText"),F=d("Textarea"),c=d("Button"),y=d("Card"),P=d("Password"),O=d("Tag"),D=I,J=d("Toast");return g(),k("div",Q,[e[19]||(e[19]=s("h1",{class:"text-3xl font-bold text-gray-900 mb-8"},"Profile Settings",-1)),s("div",R,[s("div",W,[l(y,null,{content:n(()=>[s("div",X,[e[10]||(e[10]=s("h2",{class:"text-xl font-semibold text-gray-900"},"Profile Information",-1)),s("form",{onSubmit:h(T,["prevent"]),class:"space-y-6"},[s("div",Y,[e[6]||(e[6]=s("label",{for:"fullName",class:"block text-sm font-medium text-gray-700"},"Full Name",-1)),l(w,{id:"fullName",modelValue:t.value.fullName,"onUpdate:modelValue":e[0]||(e[0]=o=>t.value.fullName=o),class:"w-full"},null,8,["modelValue"])]),s("div",Z,[e[7]||(e[7]=s("label",{for:"email",class:"block text-sm font-medium text-gray-700"},"Email",-1)),l(w,{id:"email",modelValue:t.value.email,"onUpdate:modelValue":e[1]||(e[1]=o=>t.value.email=o),type:"email",class:"w-full",disabled:""},null,8,["modelValue"])]),s("div",$,[e[8]||(e[8]=s("label",{for:"bio",class:"block text-sm font-medium text-gray-700"},"Bio",-1)),l(F,{id:"bio",modelValue:t.value.bio,"onUpdate:modelValue":e[2]||(e[2]=o=>t.value.bio=o),rows:"4",class:"w-full"},null,8,["modelValue"])]),s("div",null,[l(c,{type:"submit",loading:b.value,class:"w-full"},{default:n(()=>e[9]||(e[9]=[E(" Save Changes ")])),_:1,__:[9]},8,["loading"])])],32)])]),_:1}),l(y,{class:"mt-6"},{content:n(()=>[s("div",ee,[e[15]||(e[15]=s("h2",{class:"text-xl font-semibold text-gray-900"},"Change Password",-1)),s("form",{onSubmit:h(U,["prevent"]),class:"space-y-6"},[s("input",{type:"email",value:t.value.email,autocomplete:"username",style:{display:"none"}},null,8,se),s("div",ae,[e[11]||(e[11]=s("label",{for:"currentPassword",class:"block text-sm font-medium text-gray-700"},"Current Password",-1)),l(P,{id:"currentPassword",modelValue:r.value.currentPassword,"onUpdate:modelValue":e[3]||(e[3]=o=>r.value.currentPassword=o),feedback:!1,toggleMask:"",inputProps:{autocomplete:"current-password"},class:"w-full"},null,8,["modelValue"])]),s("div",le,[e[12]||(e[12]=s("label",{for:"newPassword",class:"block text-sm font-medium text-gray-700"},"New Password",-1)),l(P,{id:"newPassword",modelValue:r.value.newPassword,"onUpdate:modelValue":e[4]||(e[4]=o=>r.value.newPassword=o),feedback:!1,toggleMask:"",inputProps:{autocomplete:"new-password"},class:"w-full"},null,8,["modelValue"])]),s("div",oe,[e[13]||(e[13]=s("label",{for:"confirmPassword",class:"block text-sm font-medium text-gray-700"},"Confirm New Password",-1)),l(P,{id:"confirmPassword",modelValue:r.value.confirmPassword,"onUpdate:modelValue":e[5]||(e[5]=o=>r.value.confirmPassword=o),feedback:!1,toggleMask:"",inputProps:{autocomplete:"new-password"},class:"w-full"},null,8,["modelValue"])]),s("div",null,[l(c,{type:"submit",loading:_.value,severity:"secondary",class:"w-full"},{default:n(()=>e[14]||(e[14]=[E(" Change Password ")])),_:1,__:[14]},8,["loading"])])],32)])]),_:1})]),s("div",te,[l(y,null,{content:n(()=>{var o,S,V;return[s("div",re,[e[17]||(e[17]=s("h2",{class:"text-xl font-semibold text-gray-900"},"Subscription",-1)),s("div",ie,[e[16]||(e[16]=s("span",{class:"text-gray-700"},"Status",-1)),l(O,{value:(o=m.value)!=null&&o.is_premium?"Premium":"Free",severity:(S=m.value)!=null&&S.is_premium?"success":"info"},null,8,["value","severity"])]),(V=m.value)!=null&&V.is_premium?(g(),k("div",de,[l(c,{onClick:A,class:"w-full",severity:"secondary",label:"Manage Subscription"})])):(g(),k("div",ne,[l(c,{onClick:B,class:"w-full",label:"Upgrade to Premium"})]))])]}),_:1}),l(y,null,{content:n(()=>{var o;return[s("div",ue,[e[18]||(e[18]=s("h2",{class:"text-xl font-semibold text-gray-900"},"Account Actions",-1)),s("div",me,[(o=m.value)!=null&&o.is_admin?(g(),G(D,{key:0,to:"/admin",class:"block w-full"},{default:n(()=>[l(c,{class:"w-full",severity:"secondary",label:"Admin Dashboard",icon:"pi pi-cog"})]),_:1})):H("",!0),l(c,{onClick:M,class:"w-full",severity:"danger",label:"Delete Account"})])])]}),_:1})])]),l(J)])}}};export{we as default};
