import{_ as E}from"./DR4QdooF.js";import{p as M,q as T,s as u,v as I,j as O,x as D,y as $,c as x,a as s,b as n,m as P,z as H,w as C,k as o,F as z,r as G,l as c,o as g,A as J}from"./DhNaSuU-.js";import{u as K}from"./CqJylN-A.js";import{u as Q}from"./-WU5Ls9F.js";import"./42Az2i64.js";import"./sbWH3_uq.js";const W={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},X={class:"field"},Y={class:"field"},Z={class:"field"},ee={class:"field"},te={class:"flex justify-end"},ae={key:0},se={class:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3"},oe={class:"mt-8 flex justify-center"},ge={__name:"search",async setup(re){let m,w;const k=K(),q=M(),L=T(),a=u({query:"",category:null,rating:null,sort:"created_at",order:"desc"}),y=u([]),d=u(1),V=u(0),v=u(!1),R=u(!1),S=I({get:()=>(d.value-1)*12,set:t=>{d.value=Math.floor(t/12)+1}}),{data:F}=([m,w]=O(async()=>Q("categories",async()=>{const{data:t}=await k.from("categories").select("*").order("name");return t})),m=await m,w(),m),U=[{label:"Any Rating",value:null},{label:"4 Stars & Up",value:4},{label:"3 Stars & Up",value:3},{label:"2 Stars & Up",value:2},{label:"1 Star & Up",value:1}],A=[{label:"Newest First",value:"created_at"},{label:"Oldest First",value:"created_at_asc"},{label:"Highest Rated",value:"rating"},{label:"Lowest Rated",value:"rating_asc"},{label:"Most Helpful",value:"helpful_count"}],B=()=>{d.value=1,_()},N=t=>{d.value=Math.floor(t.first/12)+1,_()},_=async()=>{v.value=!0,R.value=!0;try{let t=k.from("reviews").select(`
        *,
        profiles:user_id (full_name, avatar_url),
        categories (name, slug)
      `,{count:"exact"});a.value.query&&(t=t.or(`title.ilike.%${a.value.query}%,content.ilike.%${a.value.query}%`)),t=t.eq("is_published",!0),a.value.category&&(t=t.eq("category_id",a.value.category)),a.value.rating&&(t=t.gte("rating",a.value.rating));const[e,i]=a.value.sort.split("_");t=t.order(e==="created"?"created_at":e,{ascending:i==="asc"});const l=(d.value-1)*12,b=l+11;t=t.range(l,b);const{data:p,count:h,error:f}=await t;if(f){console.error("Error fetching search results:",f),toast.add({severity:"error",summary:"Error",detail:"Failed to fetch search results. Please try again.",life:3e3});return}y.value=p||[],V.value=h||0}catch(t){console.error("Error fetching search results:",t),toast.add({severity:"error",summary:"Error",detail:"An unexpected error occurred. Please try again.",life:3e3})}finally{v.value=!1}};return D(()=>{const{query:t,category:e,rating:i,sort:l}=q.query;t&&(a.value.query=t),e&&(a.value.category=parseInt(e)),i&&(a.value.rating=parseInt(i)),l&&(a.value.sort=l),Object.keys(q.query).length>0&&_()}),$(a,t=>{const e={...t};e.category||delete e.category,e.rating||delete e.rating,e.query||delete e.query,e.sort==="created_at"&&delete e.sort,L.push({query:e})},{deep:!0}),(t,e)=>{const i=c("InputText"),l=c("Dropdown"),b=c("Button"),p=c("Card"),h=E,f=c("Paginator"),j=c("Toast");return g(),x("div",null,[e[10]||(e[10]=s("h1",{class:"text-3xl font-bold text-gray-900 mb-8"},"Search Reviews",-1)),n(p,{class:"mb-8"},{content:C(()=>[s("form",{onSubmit:J(B,["prevent"]),class:"space-y-4"},[s("div",W,[s("div",X,[e[5]||(e[5]=s("label",{for:"query",class:"block text-sm font-medium text-gray-700"},"Search",-1)),n(i,{id:"query",modelValue:o(a).query,"onUpdate:modelValue":e[0]||(e[0]=r=>o(a).query=r),class:"w-full",placeholder:"Search reviews..."},null,8,["modelValue"])]),s("div",Y,[e[6]||(e[6]=s("label",{for:"category",class:"block text-sm font-medium text-gray-700"},"Category",-1)),n(l,{id:"category",modelValue:o(a).category,"onUpdate:modelValue":e[1]||(e[1]=r=>o(a).category=r),options:o(F),optionLabel:"name",optionValue:"id",placeholder:"All Categories",class:"w-full"},null,8,["modelValue","options"])]),s("div",Z,[e[7]||(e[7]=s("label",{for:"rating",class:"block text-sm font-medium text-gray-700"},"Rating",-1)),n(l,{id:"rating",modelValue:o(a).rating,"onUpdate:modelValue":e[2]||(e[2]=r=>o(a).rating=r),options:U,optionLabel:"label",optionValue:"value",placeholder:"Any Rating",class:"w-full"},null,8,["modelValue"])]),s("div",ee,[e[8]||(e[8]=s("label",{for:"sort",class:"block text-sm font-medium text-gray-700"},"Sort By",-1)),n(l,{id:"sort",modelValue:o(a).sort,"onUpdate:modelValue":e[3]||(e[3]=r=>o(a).sort=r),options:A,optionLabel:"label",optionValue:"value",class:"w-full"},null,8,["modelValue"])])]),s("div",te,[n(b,{type:"submit",loading:o(v),label:"Search"},null,8,["loading"])])],32)]),_:1}),o(y).length>0?(g(),x("div",ae,[s("div",se,[(g(!0),x(z,null,G(o(y),r=>(g(),P(h,{key:r.id,review:r},null,8,["review"]))),128))]),s("div",oe,[n(f,{first:S.value,"onUpdate:first":e[4]||(e[4]=r=>S.value=r),rows:12,totalRecords:o(V),onPage:N,template:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink"},null,8,["first","totalRecords"])])])):o(R)?(g(),P(p,{key:1,class:"text-center py-12"},{content:C(()=>e[9]||(e[9]=[s("div",{class:"text-gray-500"},[s("i",{class:"pi pi-search text-4xl mb-4"}),s("p",{class:"text-lg"},"No reviews found matching your criteria."),s("p",{class:"mt-2"},"Try adjusting your search filters.")],-1)])),_:1})):H("",!0),n(j)])}}};export{ge as default};
