import{_ as F}from"./C9o6SUgA.js";import{B as H,C as G,q as J,p as K,s as f,j as O,x as Q,c as U,a as t,b as i,z as W,w as v,k as l,d as I,l as r,o as R,t as u,A as X}from"./Bf3otjuS.js";import{u as Y}from"./ByTvV72R.js";import{u as Z}from"./vtWOP-mq.js";import{f as ee}from"./sbWH3_uq.js";const te={class:"max-w-4xl mx-auto"},se={class:"flex items-center justify-between mb-8"},le={class:"flex items-center justify-between"},oe={class:"flex items-center space-x-2"},ie={class:"space-y-6"},ae={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"},ne={class:"text-sm text-gray-900"},re={class:"text-sm text-gray-900"},de={class:"text-sm text-gray-900"},ue={class:"text-sm text-gray-900"},me={class:"text-sm text-gray-900"},ce={class:"text-sm text-gray-900"},pe={class:"field mb-4"},be={class:"field mb-4"},fe={class:"field mb-4"},ve={class:"field mb-4"},ge={class:"field mb-6"},ye={class:"flex items-center"},xe={class:"mt-1 text-sm text-gray-500"},_e={class:"flex items-center space-x-4"},we={key:0,class:"p-6 bg-red-50 border border-red-200 rounded text-red-700 mt-8"},De={__name:"[id]",async setup(he){let m,g;const c=Y();H();const p=G(),q=J(),y=K(),d=f(null),s=f({title:"",content:"",category_id:null,rating:null,is_published:!0}),b=f(!1),{data:B}=([m,g]=O(async()=>Z("categories",async()=>{const{data:o}=await c.from("categories").select("*").order("name");return o})),m=await m,g(),m);Q(async()=>{const o=y.params.id;console.log("[admin/reviews/[id]] Attempting to fetch review with ID:",o);const{data:e,error:a}=await c.from("reviews").select(`
      *,
      author:profiles(*)
    `).eq("id",o).single();if(console.log("[admin/reviews/[id]] Fetch result:",e,"Error:",a),a||!e){p.add({severity:"error",summary:"Error",detail:(a==null?void 0:a.message)||"Review not found",life:5e3}),s.value=null;return}d.value=e,s.value={title:e.title,content:e.content,category_id:e.category_id,rating:e.rating,is_published:e.is_published}});const x=o=>o?ee(new Date(o),"MMM d, yyyy h:mm a"):"N/A",A=o=>o.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),_=async()=>{b.value=!0;const o=y.params.id;try{const{error:e}=await c.from("reviews").update({title:s.value.title,slug:A(s.value.title),content:s.value.content,category_id:s.value.category_id,rating:s.value.rating,is_published:s.value.is_published}).eq("id",o);if(e)throw e;p.add({severity:"success",summary:"Success",detail:`Review ${s.value.is_published?"published":"saved as draft"} successfully`,life:3e3}),q.push("/admin/reviews")}catch(e){p.add({severity:"error",summary:"Error",detail:e.message,life:3e3})}finally{b.value=!1}},E=async()=>{s.value.is_published=!s.value.is_published,await _()};return(o,e)=>{const a=r("Button"),N=F,P=r("Tag"),M=r("InputText"),w=r("Dropdown"),j=r("Textarea"),L=r("InputSwitch"),z=r("Card"),$=r("Toast");return R(),U("div",te,[t("div",se,[e[5]||(e[5]=t("h1",{class:"text-3xl font-bold text-gray-900"},"Edit Review",-1)),i(N,{to:"/admin/reviews"},{default:v(()=>[i(a,{label:"Back to Reviews",icon:"pi pi-arrow-left",severity:"secondary"})]),_:1})]),i(z,{class:"mb-6"},{header:v(()=>[t("div",le,[e[7]||(e[7]=t("h2",{class:"text-xl font-semibold text-gray-900"},"Review Information",-1)),t("div",oe,[e[6]||(e[6]=t("span",{class:"text-sm text-gray-600"},"Status:",-1)),i(P,{value:l(s).is_published?"Published":"Draft",severity:l(s).is_published?"success":"warning"},null,8,["value","severity"])])])]),content:v(()=>{var h,V,k,S,T,C,D;return[t("div",ie,[t("div",ae,[t("div",null,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-gray-500 mb-1"},"Created",-1)),t("div",ne,u(x((h=l(d))==null?void 0:h.created_at)),1)]),t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-gray-500 mb-1"},"Last Updated",-1)),t("div",re,u(x((V=l(d))==null?void 0:V.updated_at)),1)]),t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-500 mb-1"},"Views",-1)),t("div",de,u(((k=l(d))==null?void 0:k.views_count)||0),1)]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-500 mb-1"},"Helpful Votes",-1)),t("div",ue,u(((S=l(d))==null?void 0:S.helpful_count)||0),1)]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-500 mb-1"},"Author",-1)),t("div",me,u((C=(T=l(d))==null?void 0:T.author)==null?void 0:C.full_name),1)]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-500 mb-1"},"Slug",-1)),t("div",ce,u((D=l(d))==null?void 0:D.slug),1)])]),t("form",{onSubmit:X(_,["prevent"])},[t("div",pe,[e[14]||(e[14]=t("label",{for:"title",class:"block text-sm font-medium text-gray-700"},"Title",-1)),i(M,{id:"title",modelValue:l(s).title,"onUpdate:modelValue":e[0]||(e[0]=n=>l(s).title=n),class:"w-full",required:""},null,8,["modelValue"])]),t("div",be,[e[15]||(e[15]=t("label",{for:"category",class:"block text-sm font-medium text-gray-700"},"Category",-1)),i(w,{id:"category",modelValue:l(s).category_id,"onUpdate:modelValue":e[1]||(e[1]=n=>l(s).category_id=n),options:l(B),"option-label":"name","option-value":"id",placeholder:"Select a category",class:"w-full",required:""},null,8,["modelValue","options"])]),t("div",fe,[e[16]||(e[16]=t("label",{for:"content",class:"block text-sm font-medium text-gray-700"},"Content",-1)),i(j,{id:"content",modelValue:l(s).content,"onUpdate:modelValue":e[2]||(e[2]=n=>l(s).content=n),rows:"10",class:"w-full",required:""},null,8,["modelValue"])]),t("div",ve,[e[17]||(e[17]=t("label",{for:"rating",class:"block text-sm font-medium text-gray-700"},"Rating",-1)),i(w,{id:"rating",modelValue:l(s).rating,"onUpdate:modelValue":e[3]||(e[3]=n=>l(s).rating=n),options:[1,2,3,4,5],placeholder:"Select a rating",class:"w-full",required:""},null,8,["modelValue"])]),t("div",ge,[t("div",ye,[i(L,{modelValue:l(s).is_published,"onUpdate:modelValue":e[4]||(e[4]=n=>l(s).is_published=n),class:"mr-2"},null,8,["modelValue"]),e[18]||(e[18]=t("label",{class:"text-sm font-medium text-gray-700"},"Published",-1))]),t("p",xe,u(l(s).is_published?"This review is visible to the public":"This review is currently in draft mode"),1)]),t("div",_e,[i(a,{type:"submit",loading:l(b),label:l(s).is_published?"Update & Publish":"Update as Draft"},null,8,["loading","label"]),i(a,{type:"button",severity:"secondary",label:l(s).is_published?"Unpublish":"Publish",onClick:E},null,8,["label"])])],32)])]}),_:1}),i($),l(s)===null?(R(),U("div",we,e[19]||(e[19]=[t("strong",null,"Error:",-1),I(" Review not found or you do not have access."),t("br",null,null,-1),I(" Please check the review ID or your permissions. ")]))):W("",!0)])}}};export{De as default};
